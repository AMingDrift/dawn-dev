{% doc %}
  @prompt
    Create a sticky sidebar effect for product pages that handles asymmetric content heights. When the left side (product images) and right side (variant options and cart) have different heights, the shorter side should stick (fix) in place while scrolling. The solution must intelligently detect which side is shorter and apply sticky positioning to that side, working for both scenarios: left side taller than right, or right side taller than left. The sticky element should remain visible as users scroll through the longer content on the opposite side. Use CSS position: sticky with appropriate top offset and ensure smooth behavior across desktop viewports.
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-sticky-sidebar-{{ ai_gen_id }} {
    display: block;
    width: 100%;
  }

  .ai-sticky-sidebar__container-{{ ai_gen_id }} {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: {{ block.settings.gap }}px;
    align-items: flex-start;
    max-width: {{ block.settings.max_width }}px;
    margin: 0 auto;
    padding: {{ block.settings.vertical_padding }}px {{ block.settings.horizontal_padding }}px;
  }

  .ai-sticky-sidebar__left-{{ ai_gen_id }},
  .ai-sticky-sidebar__right-{{ ai_gen_id }} {
    width: 100%;
  }

  .ai-sticky-sidebar__sticky-{{ ai_gen_id }} {
    position: sticky;
    top: {{ block.settings.sticky_offset }}px;
  }

  .ai-sticky-sidebar__content-{{ ai_gen_id }} {
    background-color: {{ block.settings.content_bg_color }};
    padding: {{ block.settings.content_padding }}px;
    border-radius: {{ block.settings.border_radius }}px;
  }

  .ai-sticky-sidebar__placeholder-{{ ai_gen_id }} {
    background-color: #f4f4f4;
    border-radius: {{ block.settings.border_radius }}px;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 300px;
    color: #666;
    font-size: 14px;
    text-align: center;
    padding: 20px;
  }

  @media screen and (max-width: 989px) {
    .ai-sticky-sidebar__container-{{ ai_gen_id }} {
      grid-template-columns: 1fr;
      gap: {{ block.settings.gap_mobile }}px;
    }

    .ai-sticky-sidebar__sticky-{{ ai_gen_id }} {
      position: static;
    }
  }
{% endstyle %}

<sticky-sidebar-{{ ai_gen_id }}
  class="ai-sticky-sidebar-{{ ai_gen_id }}"
  data-sticky-offset="{{ block.settings.sticky_offset }}"
  {{ block.shopify_attributes }}
>
  <div class="ai-sticky-sidebar__container-{{ ai_gen_id }}">
    <div class="ai-sticky-sidebar__left-{{ ai_gen_id }}" data-sidebar-side="left">
      <div class="ai-sticky-sidebar__content-{{ ai_gen_id }}">
        {% if block.settings.left_content != blank %}
          {{ block.settings.left_content }}
        {% else %}
          <div class="ai-sticky-sidebar__placeholder-{{ ai_gen_id }}">
            Left side content<br>Add content using the Liquid setting
          </div>
        {% endif %}
      </div>
    </div>

    <div class="ai-sticky-sidebar__right-{{ ai_gen_id }}" data-sidebar-side="right">
      <div class="ai-sticky-sidebar__content-{{ ai_gen_id }}">
        {% if block.settings.right_content != blank %}
          {{ block.settings.right_content }}
        {% else %}
          <div class="ai-sticky-sidebar__placeholder-{{ ai_gen_id }}">
            Right side content<br>Add content using the Liquid setting
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</sticky-sidebar-{{ ai_gen_id }}>

<script>
  (function() {
    class StickySidebar{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.leftSide = null;
        this.rightSide = null;
        this.stickyOffset = 0;
        this.resizeObserver = null;
        this.isDesktop = window.innerWidth > 989;
      }

      connectedCallback() {
        this.leftSide = this.querySelector('[data-sidebar-side="left"]');
        this.rightSide = this.querySelector('[data-sidebar-side="right"]');
        this.stickyOffset = parseInt(this.dataset.stickyOffset) || 20;

        this.setupStickyBehavior();
        this.setupResizeObserver();
        this.handleResize();

        window.addEventListener('resize', this.handleResize.bind(this));
      }

      disconnectedCallback() {
        if (this.resizeObserver) {
          this.resizeObserver.disconnect();
        }
        window.removeEventListener('resize', this.handleResize.bind(this));
      }

      handleResize() {
        const wasDesktop = this.isDesktop;
        this.isDesktop = window.innerWidth > 989;

        if (wasDesktop !== this.isDesktop) {
          this.setupStickyBehavior();
        }
      }

      setupResizeObserver() {
        if (!window.ResizeObserver) return;

        this.resizeObserver = new ResizeObserver(() => {
          if (this.isDesktop) {
            this.setupStickyBehavior();
          }
        });

        this.resizeObserver.observe(this.leftSide);
        this.resizeObserver.observe(this.rightSide);
      }

      setupStickyBehavior() {
        if (!this.isDesktop) {
          this.leftSide.classList.remove('ai-sticky-sidebar__sticky-{{ ai_gen_id }}');
          this.rightSide.classList.remove('ai-sticky-sidebar__sticky-{{ ai_gen_id }}');
          return;
        }

        const leftHeight = this.leftSide.offsetHeight;
        const rightHeight = this.rightSide.offsetHeight;

        this.leftSide.classList.remove('ai-sticky-sidebar__sticky-{{ ai_gen_id }}');
        this.rightSide.classList.remove('ai-sticky-sidebar__sticky-{{ ai_gen_id }}');

        if (leftHeight < rightHeight) {
          this.leftSide.classList.add('ai-sticky-sidebar__sticky-{{ ai_gen_id }}');
        } else if (rightHeight < leftHeight) {
          this.rightSide.classList.add('ai-sticky-sidebar__sticky-{{ ai_gen_id }}');
        }
      }
    }

    customElements.define('sticky-sidebar-{{ ai_gen_id }}', StickySidebar{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Sticky sidebar",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "liquid",
      "id": "left_content",
      "label": "Left side content"
    },
    {
      "type": "liquid",
      "id": "right_content",
      "label": "Right side content"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "max_width",
      "min": 800,
      "max": 1600,
      "step": 100,
      "unit": "px",
      "label": "Maximum width",
      "default": 1200
    },
    {
      "type": "range",
      "id": "gap",
      "min": 20,
      "max": 100,
      "step": 10,
      "unit": "px",
      "label": "Gap between columns",
      "default": 40
    },
    {
      "type": "range",
      "id": "gap_mobile",
      "min": 10,
      "max": 60,
      "step": 5,
      "unit": "px",
      "label": "Gap on mobile",
      "default": 20
    },
    {
      "type": "range",
      "id": "vertical_padding",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "px",
      "label": "Vertical padding",
      "default": 40
    },
    {
      "type": "range",
      "id": "horizontal_padding",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "px",
      "label": "Horizontal padding",
      "default": 20
    },
    {
      "type": "header",
      "content": "Sticky behavior"
    },
    {
      "type": "range",
      "id": "sticky_offset",
      "min": 0,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "Sticky offset from top",
      "default": 20
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "color",
      "id": "content_bg_color",
      "label": "Content background",
      "default": "#FFFFFF"
    },
    {
      "type": "range",
      "id": "content_padding",
      "min": 0,
      "max": 60,
      "step": 5,
      "unit": "px",
      "label": "Content padding",
      "default": 20
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 0
    },
    {
      "type": "range",
      "id": "desktop_width_percent",
      "label": "Desktop width",
      "min": 50,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 100
    }
  ],
  "presets": [
    {
      "name": "Sticky sidebar"
    }
  ]
}
{% endschema %}
